"use strict";var G=Object.create;var h=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var Y=(u,t)=>{for(var e in t)h(u,e,{get:t[e],enumerable:!0})},F=(u,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of V(t))!K.call(u,r)&&r!==e&&h(u,r,{get:()=>t[r],enumerable:!(n=j(t,r))||n.enumerable});return u};var B=(u,t,e)=>(e=u!=null?G(X(u)):{},F(t||!u||!u.__esModule?h(e,"default",{value:u,enumerable:!0}):e,u)),Q=u=>F(h({},"__esModule",{value:!0}),u);var Z={};Y(Z,{BCS:()=>a.BCS,DEFAULT_CHAIN_ID:()=>H,DEFAULT_ENABLE_SIMULATION:()=>P,DEFAULT_GAS_PRICE:()=>R,DEFAULT_MAX_GAS_FOR_SUPRA_TRANSFER_WHEN_RECEIVER_EXISTS:()=>O,DEFAULT_MAX_GAS_FOR_SUPRA_TRANSFER_WHEN_RECEIVER_NOT_EXISTS:()=>I,DEFAULT_MAX_GAS_UNITS:()=>w,DEFAULT_RECORDS_ITEMS_COUNT:()=>A,DEFAULT_TX_EXPIRATION_DURATION:()=>E,DEFAULT_WAIT_FOR_TX_COMPLETION:()=>N,DELAY_BETWEEN_POOLING_REQUEST:()=>W,HexString:()=>a.HexString,MAX_RETRY_FOR_TRANSACTION_COMPLETION:()=>q,MILLISECONDS_PER_SECOND:()=>v,RAW_TRANSACTION_SALT:()=>U,RAW_TRANSACTION_WITH_DATA_SALT:()=>C,SUPRA_COIN_TYPE:()=>S,SUPRA_FRAMEWORK_ADDRESS:()=>p,SupraAccount:()=>a.SupraAccount,SupraClient:()=>M,TransactionStatus:()=>x,TxTypeForTransactionInsights:()=>b,TxnBuilderTypes:()=>a.TxnBuilderTypes});module.exports=Q(Z);var a=require("supra-l1-sdk-core"),k=B(require("axios"));var d=require("supra-l1-sdk-core"),m=u=>{let t=new Array;return u.forEach(e=>{let n=e.value;t.push({struct:{address:n.address.toHexString().toString(),module:n.module_name.value,name:n.name.value,type_args:m(n.type_args)}})}),t},D=u=>{let t=new Array;return u.forEach(e=>{if(e instanceof d.TxnBuilderTypes.TransactionArgumentU8)t.push({U8:e.value});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentU32)t.push({U32:e.value});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentU64)t.push({U64:Number(e.value)});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentU128)t.push({U128:Number(e.value)});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentU256)t.push({U256:Array.from(d.BCS.bcsSerializeU256(e.value))});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentAddress)t.push({Address:e.value.toHexString().toString()});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentU8Vector)t.push({U8Vector:Array.from(e.value)});else if(e instanceof d.TxnBuilderTypes.TransactionArgumentBool)t.push({Bool:e.value});else throw new Error("Invalid script argument variant")}),t},y=u=>{let t=new Array;for(let e=0;e<u.length;e++)t.push(Array.from(u[e]));return t},_=u=>{let t=u.toLowerCase();if(t.length<66)return t.startsWith("0x")?t=t.slice(2).padStart(64,"0"):t=t.padStart(64,"0"),"0x"+t;if(t.length===66&&t.startsWith("0x"))return t;throw new Error("Invalid address. With '0x', address length should be exactly 66 characters.")},J=u=>new Promise(t=>{setTimeout(t,u)});var x=(n=>(n.Success="Success",n.Failed="Failed",n.Pending="Pending",n))(x||{}),b=(s=>(s.CoinTransfer="CoinTransfer",s.EntryFunctionCall="EntryFunctionCall",s.ScriptCall="ScriptCall",s.AutomationRegistration="AutomationRegistration",s.MultisigPayload="MultisigPayload",s))(b||{});var H=6,q=300,W=1e3,A=15,w=BigInt(5e5),R=BigInt(100),E=300,v=1e3,p="0x0000000000000000000000000000000000000000000000000000000000000001",S="0x1::supra_coin::SupraCoin",P=!1,N=!1,O=10,I=1020,U="SUPRA::RawTransaction",C="SUPRA::RawTransactionWithData";var f=B(require("js-sha3"));var M=class u{constructor(t,e=6){this.supraNodeURL=t,this.chainId=new a.TxnBuilderTypes.ChainId(e)}static async init(t){let e=new u(t);return e.chainId=await e.getChainId(),e}async sendRequest(t,e,n){if(!t&&n===void 0)throw new Error("POST request requires a 'data' payload.");let r={method:t?"get":"post",baseURL:this.supraNodeURL,url:e,...t?{}:{data:n,headers:{"Content-Type":"application/json"}}},s=await(0,k.default)(r);if(s.status===404)throw new Error("Invalid URL \u2014 path not found (404).");if(s.status===500)throw new Error("Server error \u2014 please try again later.");return s}async getChainId(){return new a.TxnBuilderTypes.ChainId(Number((await this.sendRequest(!0,"/rpc/v1/transactions/chain_id")).data))}async getGasPrice(){return BigInt((await this.sendRequest(!0,"/rpc/v1/transactions/estimate_gas_price")).data.mean_gas_price)}async fundAccountWithFaucet(t){let n=(await this.sendRequest(!0,`/rpc/v1/wallet/faucet/${t.toString()}`)).data;if(typeof n!="object"||n===null)throw new Error("Unexpected response format. Please try faucet later.");if(!("Accepted"in n))throw new Error("Faucet request failed \u2014 'Accepted' field not found in response.");let r=n.Accepted;return{status:await this.waitForTransactionCompletion(r),transactionHash:r}}async isAccountExists(t){let e=await this.sendRequest(!0,`/rpc/v1/accounts/${t.toString()}`);return!(e.data===null||e.status===202)}async getAccountInfo(t){let n=(await this.sendRequest(!0,`/rpc/v1/accounts/${t.toString()}`)).data;if(!n||typeof n!="object")throw new Error("Account does not exist or an invalid account was provided.");return{sequence_number:BigInt(n.sequence_number),authentication_key:n.authentication_key}}async getAccountResources(t,e){let n=`/rpc/v1/accounts/${t.toString()}/resources?count=${e?.count??15}`;return e?.start&&(n+=`&start=${e.start}`),(await this.sendRequest(!0,n)).data.Resources}async getResourceData(t,e){let r=(await this.sendRequest(!0,`/rpc/v1/accounts/${t.toString()}/resources/${e}`)).data?.result;if(!Array.isArray(r)||r.length===0||r[0]==null)throw new Error(`Resource of type '${e}' not found for account ${t.toString()}.`);return r[0]}async getTransactionStatus(t){let e=await this.sendRequest(!0,`/rpc/v1/transactions/${t}`);return e.data==null?null:e.data.status=="Unexecuted"?"Pending":e.data.status=="Fail"?"Failed":e.data.status}getCoinChangeAmount(t,e){let n=new Map;e.forEach(s=>{if((s.type==="0x1::coin::CoinDeposit"||s.type==="0x1::coin::CoinWithdraw")&&"0x"+s.data.account.substring(2,s.data.account).padStart(64,"0")===t){if(s.type==="0x1::coin::CoinDeposit"){let i=n.get(s.data.coin_type);i!=null?n.set(s.data.coin_type,{totalDeposit:i.totalDeposit+BigInt(s.data.amount),totalWithdraw:i.totalWithdraw}):n.set(s.data.coin_type,{totalDeposit:BigInt(s.data.amount),totalWithdraw:BigInt(0)})}else if(s.type==="0x1::coin::CoinWithdraw"){let i=n.get(s.data.coin_type);i!=null?n.set(s.data.coin_type,{totalDeposit:i.totalDeposit,totalWithdraw:i.totalWithdraw+BigInt(s.data.amount)}):n.set(s.data.coin_type,{totalDeposit:BigInt(0),totalWithdraw:BigInt(s.data.amount)})}}});let r=[];return n.forEach((s,i)=>{r.push({coinType:i,amount:s.totalDeposit-s.totalWithdraw})}),r}getTransactionInsights(t,e){let n={coinReceiver:"",coinChange:[{amount:BigInt(0),coinType:""}],type:"EntryFunctionCall"};if(e.payload.Move.type==="entry_function_payload")if(e.payload.Move.function==="0x1::supra_account::transfer"){let r=BigInt(e.payload.Move.arguments[1]);t===e.header.sender.Move&&(r*=BigInt(-1)),n.coinReceiver=e.payload.Move.arguments[0],n.coinChange[0]={amount:r,coinType:S},n.type="CoinTransfer"}else if(e.payload.Move.function==="0x1::supra_account::transfer_coins"||e.payload.Move.function==="0x1::coin::transfer"){let r=BigInt(e.payload.Move.arguments[1]);t===e.header.sender.Move&&(r*=BigInt(-1)),n.coinReceiver=e.payload.Move.arguments[0],n.coinChange[0]={amount:r,coinType:e.payload.Move.type_arguments[0]},n.type="CoinTransfer"}else e.status==="Success"&&(n.coinChange=this.getCoinChangeAmount(t,e.output.Move.events));else{if(e.payload.Move.type==="script_payload")n.type="ScriptCall";else if(e.payload.Move.type==="automation_registration_payload")n.type="AutomationRegistration";else if(e.payload.Move.type==="multisig_payload")n.type="MultisigPayload";else throw new Error("Unsupported transaction payload type.");e.status==="Success"&&(n.coinChange=this.getCoinChangeAmount(t,e.output.Move.events))}return n}async getTransactionDetail(t,e){let n=await this.sendRequest(!0,`/rpc/v1/transactions/${e}`);return n.data==null?null:n.data.status==="Pending"||n.data.output===null||n.data.header===null?{txHash:e,sender:n.data.header.sender.Move,sequenceNumber:n.data.header.sequence_number,maxGasAmount:n.data.header.max_gas_amount,gasUnitPrice:n.data.header.gas_unit_price,gasUsed:void 0,transactionCost:void 0,txExpirationTimestamp:Number(n.data.header.expiration_timestamp.microseconds_since_unix_epoch),txConfirmationTime:void 0,status:n.data.status,events:void 0,blockNumber:void 0,blockHash:void 0,transactionInsights:this.getTransactionInsights(t.toString(),n.data),vm_status:void 0}:{txHash:e,sender:n.data.header.sender.Move,sequenceNumber:n.data.header.sequence_number,maxGasAmount:n.data.header.max_gas_amount,gasUnitPrice:n.data.header.gas_unit_price,gasUsed:n.data.output?.Move.gas_used,transactionCost:n.data.header.gas_unit_price*n.data.output?.Move.gas_used,txExpirationTimestamp:Number(n.data.header.expiration_timestamp.microseconds_since_unix_epoch),txConfirmationTime:Number(n.data.block_header.timestamp.microseconds_since_unix_epoch),status:n.data.status=="Fail"||n.data.status=="Invalid"?"Failed":n.data.status,events:n.data.output?.Move.events,blockNumber:n.data.block_header.height,blockHash:n.data.block_header.hash,transactionInsights:this.getTransactionInsights(t.toString(),n.data),vm_status:n.data.output.Move.vm_status}}async getAccountTransactionsDetail(t,e){let n=`/rpc/v1/accounts/${t.toString()}/transactions?count=${e?.count??15}`;e?.start&&(n+=`&start=${e.start}`);let r=await this.sendRequest(!0,n);if(r.data.record==null)throw new Error("Account does not exist or an invalid account was provided.");let s=[];return r.data.record.forEach(i=>{s.push({txHash:i.hash,sender:i.header.sender.Move,sequenceNumber:i.header.sequence_number,maxGasAmount:i.header.max_gas_amount,gasUnitPrice:i.header.gas_unit_price,gasUsed:i.output.Move.gas_used,transactionCost:i.header.gas_unit_price*i.output.Move.gas_used,txExpirationTimestamp:Number(i.header.expiration_timestamp.microseconds_since_unix_epoch),txConfirmationTime:Number(i.block_header.timestamp.microseconds_since_unix_epoch),status:i.status==="Fail"||i.status==="Invalid"?"Failed":i.status,events:i.output.Move.events,blockNumber:i.block_header.height,blockHash:i.block_header.hash,transactionInsights:this.getTransactionInsights(t.toString(),i),vm_status:i.output.Move.vm_status})}),s}async getCoinTransactionsDetail(t,e){let n=`/rpc/v1/accounts/${t.toString()}/coin_transactions?count=${e?.count??15}`;e?.start&&(n+=`&start=${e?.start}`);let r=await this.sendRequest(!0,n);if(r.data.record==null)throw new Error("Account does not exist or an invalid account was provided.");let s=[];return r.data.record.forEach(i=>{s.push({txHash:i.hash,sender:i.header.sender.Move,sequenceNumber:i.header.sequence_number,maxGasAmount:i.header.max_gas_amount,gasUnitPrice:i.header.gas_unit_price,gasUsed:i.output.Move.gas_used,transactionCost:i.header.gas_unit_price*i.output.Move.gas_used,txExpirationTimestamp:Number(i.header.expiration_timestamp.microseconds_since_unix_epoch),txConfirmationTime:Number(i.block_header.timestamp.microseconds_since_unix_epoch),status:i.status==="Fail"||i.status==="Invalid"?"Failed":i.status,events:i.output.Move.events,blockNumber:i.block_header.height,blockHash:i.block_header.hash,transactionInsights:this.getTransactionInsights(t.toString(),i),vm_status:i.output.Move.vm_status})}),{transactions:s,cursor:r.data.cursor}}async getAccountCompleteTransactionsDetail(t,e=15){let n=await this.sendRequest(!0,`/rpc/v1/accounts/${t.toString()}/coin_transactions?count=${e}`),r=await this.sendRequest(!0,`/rpc/v1/accounts/${t.toString()}/transactions?count=${e}`),s=[];n.data.record!=null&&s.push(...n.data.record),r.data.record!=null&&s.push(...r.data.record);let i=s.filter((o,l,g)=>l===g.findIndex(T=>T.hash===o.hash));i.sort((o,l)=>o.block_header.timestamp.microseconds_since_unix_epoch<l.block_header.timestamp.microseconds_since_unix_epoch?1:-1);let c=[];return i.forEach(o=>{c.push({txHash:o.hash,sender:o.header.sender.Move,sequenceNumber:o.header.sequence_number,maxGasAmount:o.header.max_gas_amount,gasUnitPrice:o.header.gas_unit_price,gasUsed:o.output.Move.gas_used,transactionCost:o.header.gas_unit_price*o.output.Move.gas_used,txExpirationTimestamp:Number(o.header.expiration_timestamp.microseconds_since_unix_epoch),txConfirmationTime:Number(o.block_header.timestamp.microseconds_since_unix_epoch),status:o.status==="Fail"||o.status==="Invalid"?"Failed":o.status,events:o.output.Move.events,blockNumber:o.block_header.height,blockHash:o.block_header.hash,transactionInsights:this.getTransactionInsights(t.toString(),o),vm_status:o.output.Move.vm_status})}),c}async getCoinInfo(t){let e=await this.getResourceData(new a.HexString(t.split("::")[0]),`${p}::coin::CoinInfo<${t}>`);return{name:e.name,symbol:e.symbol,decimals:e.decimals}}async getAccountSupraCoinBalance(t){return await this.getAccountCoinBalance(t,S)}async getAccountCoinBalance(t,e){return BigInt((await this.invokeViewMethod("0x1::coin::balance",[e],[t.toString()]))[0])}async invokeViewMethod(t,e,n){return(await this.sendRequest(!1,"/rpc/v1/view",{function:t,type_arguments:e,arguments:n})).data.result}async getTableItemByKey(t,e,n,r){return(await this.sendRequest(!1,`/rpc/v1/tables/${t}/item`,{key_type:e,value_type:n,key:r})).data}async waitForTransactionCompletion(t){for(let e=0;e<300;e++){let n=await this.getTransactionStatus(t);if(n===null||n=="Pending")await J(1e3);else return n}return"Pending"}async sendTx(t,e){(e?.enableTransactionSimulation??P)===!0&&await this.simulateTx(t);let n=await this.sendRequest(!1,"/rpc/v1/transactions/submit",t);return console.log("Transaction Request Sent, Waiting For Completion"),{txHash:n.data,result:(e?.enableWaitForTransaction??N)===!0?await this.waitForTransactionCompletion(n.data):"Pending"}}static getSupraTransactionSignatureMessage(t){let e=Uint8Array.from(Buffer.from(f.default.sha3_256(t instanceof a.TxnBuilderTypes.RawTransaction?U:C),"hex")),n=new Uint8Array(a.BCS.bcsToBytes(t)),r=new Uint8Array(e.length+n.length);return r.set(e),r.set(n,e.length),r}static signSupraTransaction(t,e){return t.signBuffer(u.getSupraTransactionSignatureMessage(e))}static signSupraMultiTransaction(t,e){let n=new a.TxnBuilderTypes.Ed25519Signature(u.signSupraTransaction(t,e).toUint8Array());return new a.TxnBuilderTypes.AccountAuthenticatorEd25519(new a.TxnBuilderTypes.Ed25519PublicKey(t.signingKey.publicKey),n)}getTransactionPayloadJSON(t){if(t instanceof a.TxnBuilderTypes.TransactionPayloadEntryFunction)return{EntryFunction:{module:{address:t.value.module_name.address.toHexString().toString(),name:t.value.module_name.name.value},function:t.value.function_name.value,ty_args:m(t.value.ty_args),args:y(t.value.args)}};if(t instanceof a.TxnBuilderTypes.TransactionPayloadScript)return{Script:{code:Array.from(t.value.code),ty_args:m(t.value.ty_args),args:D(t.value.args)}};if(t instanceof a.TxnBuilderTypes.TransactionPayloadAutomationRegistration){if(t.value instanceof a.TxnBuilderTypes.AutomationRegistrationParamsV1)return{AutomationRegistration:{V1:{automated_function:{module:{address:t.value.value.automated_function.module_name.address.toHexString().toString(),name:t.value.value.automated_function.module_name.name.value},function:t.value.value.automated_function.function_name.value,ty_args:m(t.value.value.automated_function.ty_args),args:y(t.value.value.automated_function.args)},max_gas_amount:Number(t.value.value.max_gas_amount),gas_price_cap:Number(t.value.value.gas_price_cap),automation_fee_cap_for_epoch:Number(t.value.value.automation_fee_cap_for_epoch),expiration_timestamp_secs:Number(t.value.value.expiration_timestamp_secs),aux_data:y(t.value.value.aux_data)}}};throw new Error("Unknown variant of `AutomationRegistrationParams`")}else if(t instanceof a.TxnBuilderTypes.TransactionPayloadMultisig){let e=t.value.multisig_address.toHexString().toString(),n=t.value.transaction_payload?.transaction_payload,r=n?{EntryFunction:{module:{address:n.module_name.address.toHexString().toString(),name:n.module_name.name.value},function:n.function_name.value,ty_args:m(n.ty_args),args:y(n.args)}}:void 0;return{Multisig:{multisig_address:e,transaction_payload:r}}}else throw new Error("Unknown variant of `TransactionPayload`")}getRawTxnJSON(t){return{sender:t.sender.toHexString().toString(),sequence_number:Number(t.sequence_number),payload:this.getTransactionPayloadJSON(t.payload),max_gas_amount:Number(t.max_gas_amount),gas_unit_price:Number(t.gas_unit_price),expiration_timestamp_secs:Number(t.expiration_timestamp_secs),chain_id:t.chain_id.value}}getSendTxPayload(t,e){return{Move:{raw_txn:this.getRawTxnJSON(e),authenticator:{Ed25519:{public_key:t.pubKey().toString(),signature:u.signSupraTransaction(t,e).toString()}}}}}async sendTxUsingSerializedRawTransaction(t,e,n){let r=this.getSendTxPayload(t,a.TxnBuilderTypes.RawTransaction.deserialize(new a.BCS.Deserializer(e)));return await this.sendTx(r,n)}async sendTxUsingSerializedRawTransactionAndSignature(t,e,n,r){let s={Move:{raw_txn:this.getRawTxnJSON(a.TxnBuilderTypes.RawTransaction.deserialize(new a.BCS.Deserializer(n))),authenticator:{Ed25519:{public_key:t.toString(),signature:e.toString()}}}};return await this.sendTx(s,r)}async sendSponsorTransaction(t,e,n,r,s,i=[],c){let o=[];i.forEach(g=>{o.push(this.getED25519AuthenticatorJSON(g))});let l={Move:{raw_txn:this.getRawTxnJSON(n),authenticator:{FeePayer:{sender:this.getED25519AuthenticatorJSON(r),secondary_signer_addresses:e,secondary_signers:o,fee_payer_address:t,fee_payer_signer:this.getED25519AuthenticatorJSON(s)}}}};return await this.sendTx(l,c)}async sendMultiAgentTransaction(t,e,n,r,s){let i=[];r.forEach(o=>{i.push(this.getED25519AuthenticatorJSON(o))});let c={Move:{raw_txn:this.getRawTxnJSON(e),authenticator:{MultiAgent:{sender:this.getED25519AuthenticatorJSON(n),secondary_signer_addresses:t,secondary_signers:i}}}};return await this.sendTx(c,s)}getED25519AuthenticatorJSON(t){return{Ed25519:{public_key:Buffer.from(t.public_key.value).toString("hex"),signature:Buffer.from(t.signature.value).toString("hex")}}}createRawTxObjectInner(t,e,n,r){return new a.TxnBuilderTypes.RawTransaction(new a.TxnBuilderTypes.AccountAddress(t.toUint8Array()),e,n,r?.maxGas??w,r?.gasUnitPrice??R,r?.txExpiryTime??BigInt(Math.ceil(Date.now()/v)+E),this.chainId)}async createRawTxObject(t,e,n,r,s,i,c,o){let l=new a.TxnBuilderTypes.TransactionPayloadEntryFunction(new a.TxnBuilderTypes.EntryFunction(new a.TxnBuilderTypes.ModuleId(new a.TxnBuilderTypes.AccountAddress(new a.HexString(_(n)).toUint8Array()),new a.TxnBuilderTypes.Identifier(r)),new a.TxnBuilderTypes.Identifier(s),i,c));return this.createRawTxObjectInner(t,e,l,o)}async createSerializedRawTxObject(t,e,n,r,s,i,c,o){return a.BCS.bcsToBytes(await this.createRawTxObject(t,e,n,r,s,i,c,o))}createSerializedScriptTxPayloadRawTxObject(t,e,n,r,s,i){let c=new a.TxnBuilderTypes.TransactionPayloadScript(new a.TxnBuilderTypes.Script(n,r,s));return a.BCS.bcsToBytes(this.createRawTxObjectInner(t,e,c,i))}createSerializedAutomationRegistrationTxPayloadRawTxObject(t,e,n,r,s,i,c,o,l,g,T,L,z){let $=new a.TxnBuilderTypes.TransactionPayloadAutomationRegistration(new a.TxnBuilderTypes.AutomationRegistrationParamsV1(new a.TxnBuilderTypes.AutomationRegistrationParamsV1Data(new a.TxnBuilderTypes.EntryFunction(new a.TxnBuilderTypes.ModuleId(new a.TxnBuilderTypes.AccountAddress(new a.HexString(_(n)).toUint8Array()),new a.TxnBuilderTypes.Identifier(r)),new a.TxnBuilderTypes.Identifier(s),i,c),o,l,g,T,L)));return a.BCS.bcsToBytes(this.createRawTxObjectInner(t,e,$,z))}createSerializedMultisigPayloadRawTxObject(t,e,n,r,s,i,c,o,l){let g=new a.TxnBuilderTypes.TransactionPayloadMultisig(new a.TxnBuilderTypes.MultiSig(a.TxnBuilderTypes.AccountAddress.fromHex(n),new a.TxnBuilderTypes.MultiSigTransactionPayload(new a.TxnBuilderTypes.EntryFunction(new a.TxnBuilderTypes.ModuleId(new a.TxnBuilderTypes.AccountAddress(new a.HexString(_(r)).toUint8Array()),new a.TxnBuilderTypes.Identifier(s)),new a.TxnBuilderTypes.Identifier(i),c,o))));return a.BCS.bcsToBytes(this.createRawTxObjectInner(t,e,g,l))}async createSerializedRawTxObjectToCreateMultisigTx(t,e,n,r,s,i,c,o,l){let g=new a.TxnBuilderTypes.MultiSigTransactionPayload(new a.TxnBuilderTypes.EntryFunction(new a.TxnBuilderTypes.ModuleId(new a.TxnBuilderTypes.AccountAddress(new a.HexString(_(r)).toUint8Array()),new a.TxnBuilderTypes.Identifier(s)),new a.TxnBuilderTypes.Identifier(i),c,o)),T=new a.HexString(f.default.sha3_256(a.BCS.bcsToBytes(g)));return await this.createSerializedRawTxObject(t,e,p,"multisig_account","create_transaction_with_hash",[],[a.BCS.bcsToBytes(a.TxnBuilderTypes.AccountAddress.fromHex(n)),a.BCS.bcsSerializeBytes(T.toUint8Array())],l)}static createSignedTransaction(t,e){return new a.TxnBuilderTypes.SignedTransaction(e,new a.TxnBuilderTypes.AccountAuthenticatorEd25519(new a.TxnBuilderTypes.Ed25519PublicKey(t.pubKey().toUint8Array()),new a.TxnBuilderTypes.Ed25519Signature(u.signSupraTransaction(t,e).toUint8Array())))}static deriveTransactionHash(t){return f.default.keccak256(a.BCS.bcsToBytes(t))}async transferSupraCoin(t,e,n,r){if(r?.optionalTransactionPayloadArgs&&!r?.optionalTransactionPayloadArgs?.maxGas){let i=BigInt(O);await this.isAccountExists(e)==!1&&(i=BigInt(I)),r.optionalTransactionPayloadArgs.maxGas=i}let s=this.getSendTxPayload(t,await this.createRawTxObject(t.address(),(await this.getAccountInfo(t.address())).sequence_number,p,"supra_account","transfer",[],[e.toUint8Array(),a.BCS.bcsSerializeUint64(n)],r?.optionalTransactionPayloadArgs));return await this.sendTx(s,r?.enableTransactionWaitAndSimulationArgs)}async transferCoin(t,e,n,r,s){let i=this.getSendTxPayload(t,await this.createRawTxObject(t.address(),(await this.getAccountInfo(t.address())).sequence_number,p,"supra_account","transfer_coins",[new a.TxnBuilderTypes.TypeTagParser(r).parseTypeTag()],[e.toUint8Array(),a.BCS.bcsSerializeUint64(n)],s?.optionalTransactionPayloadArgs));return await this.sendTx(i,s?.enableTransactionWaitAndSimulationArgs)}async publishPackage(t,e,n,r){let s=new a.BCS.Serializer,i=[];for(let o=0;o<n.length;o++)i.push(new a.TxnBuilderTypes.Module(Uint8Array.from(n[o])));a.BCS.serializeVector(i,s);let c=this.getSendTxPayload(t,await this.createRawTxObject(t.address(),(await this.getAccountInfo(t.address())).sequence_number,p,"code","publish_package_txn",[],[a.BCS.bcsSerializeBytes(e),s.getBytes()],r?.optionalTransactionPayloadArgs));return await this.sendTx(c,r?.enableTransactionWaitAndSimulationArgs)}async simulateTx(t){let e=t.Move.authenticator,n=JSON.parse(JSON.stringify(e));t.Move.authenticator=n,this.unsetAuthenticatorSignatures(t.Move.authenticator);let r=await this.sendRequest(!1,"/rpc/v1/transactions/simulate",t);if(t.Move.authenticator=e,r.data.output.Move.vm_status!=="Executed successfully")throw new Error(`Transaction simulation failed. Reason: ${r?.data?.output?.Move?.vm_status}`);return console.log("Transaction Simulation Done"),r.data}unsetAuthenticatorSignatures(t){let e="0x"+"0".repeat(128);"Ed25519"in t?t.Ed25519.signature=e:"FeePayer"in t?(t.FeePayer.sender.Ed25519.signature=e,t.FeePayer.fee_payer_signer.Ed25519.signature=e,t.FeePayer.secondary_signers.forEach(n=>{n.Ed25519.signature=e})):(t.MultiAgent.sender.Ed25519.signature=e,t.MultiAgent.secondary_signers.forEach(n=>{n.Ed25519.signature=e}))}async simulateTxUsingSerializedRawTransaction(t,e){let n={Move:{raw_txn:this.getRawTxnJSON(a.TxnBuilderTypes.RawTransaction.deserialize(new a.BCS.Deserializer(e))),authenticator:t}};return await this.simulateTx(n)}};0&&(module.exports={BCS,DEFAULT_CHAIN_ID,DEFAULT_ENABLE_SIMULATION,DEFAULT_GAS_PRICE,DEFAULT_MAX_GAS_FOR_SUPRA_TRANSFER_WHEN_RECEIVER_EXISTS,DEFAULT_MAX_GAS_FOR_SUPRA_TRANSFER_WHEN_RECEIVER_NOT_EXISTS,DEFAULT_MAX_GAS_UNITS,DEFAULT_RECORDS_ITEMS_COUNT,DEFAULT_TX_EXPIRATION_DURATION,DEFAULT_WAIT_FOR_TX_COMPLETION,DELAY_BETWEEN_POOLING_REQUEST,HexString,MAX_RETRY_FOR_TRANSACTION_COMPLETION,MILLISECONDS_PER_SECOND,RAW_TRANSACTION_SALT,RAW_TRANSACTION_WITH_DATA_SALT,SUPRA_COIN_TYPE,SUPRA_FRAMEWORK_ADDRESS,SupraAccount,SupraClient,TransactionStatus,TxTypeForTransactionInsights,TxnBuilderTypes});
//# sourceMappingURL=index.js.map